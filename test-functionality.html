<!DOCTYPE html>
<html>
<head>
    <title>Functionality Test</title>
</head>
<body>
    <h1>Family To-Do List - Functionality Test</h1>
    <div id="test-results"></div>
    
    <script>
        // Test all key functionalities
        function runTests() {
            const results = [];
            
            // Test 1: Check if localStorage functions work
            try {
                const testKey = 'test-category-key';
                const testData = ['Test1', 'Test2'];
                localStorage.setItem(testKey, JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                if (JSON.stringify(retrieved) === JSON.stringify(testData)) {
                    results.push('✅ localStorage functions work');
                } else {
                    results.push('❌ localStorage functions failed');
                }
                localStorage.removeItem(testKey);
            } catch (e) {
                results.push('❌ localStorage error: ' + e.message);
            }
            
            // Test 2: Check if DOM elements exist
            const requiredElements = [
                'category-select',
                'add-cat-btn', 
                'item-input',
                'add-btn'
            ];
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results.push(`✅ Element #${id} exists`);
                } else {
                    results.push(`❌ Element #${id} missing`);
                }
            });
            
            // Test 3: Check if category functions work
            try {
                // Simulate the category functions
                const CATEGORY_KEY = 'family-shared-list:categories';
                const LIST_ID = 'test-list';
                
                function loadCategories() {
                    try {
                        const raw = localStorage.getItem(`${CATEGORY_KEY}:${LIST_ID}`);
                        if (!raw) return null;
                        const parsed = JSON.parse(raw);
                        if (!Array.isArray(parsed)) return null;
                        return parsed;
                    } catch { return null; }
                }
                
                function saveCategories(cats) {
                    localStorage.setItem(`${CATEGORY_KEY}:${LIST_ID}`, JSON.stringify(cats));
                }
                
                function ensureDefaultCategories() {
                    const existing = loadCategories();
                    if (existing && existing.length) return existing;
                    const defaults = ['Visa', 'Car', 'New House Work'];
                    saveCategories(defaults);
                    return defaults;
                }
                
                const categories = ensureDefaultCategories();
                if (Array.isArray(categories) && categories.length > 0) {
                    results.push('✅ Category functions work');
                } else {
                    results.push('❌ Category functions failed');
                }
                
                // Clean up
                localStorage.removeItem(`${CATEGORY_KEY}:${LIST_ID}`);
            } catch (e) {
                results.push('❌ Category functions error: ' + e.message);
            }
            
            // Display results
            document.getElementById('test-results').innerHTML = results.join('<br>');
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
